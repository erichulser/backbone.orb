!function e(t,o,n){function i(s,u){if(!o[s]){if(!t[s]){var a="function"==typeof require&&require;if(!u&&a)return a(s,!0);if(r)return r(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=o[s]={exports:{}};t[s][0].call(l.exports,function(e){var o=t[s][1][e];return i(o?o:e)},l,l.exports,e,t,o,n)}return o[s].exports}for(var r="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}({1:[function(e,t,o){window.orb={},e("./schema"),e("./collection"),e("./model"),e("./queries")},{"./collection":2,"./model":3,"./queries":4,"./schema":5}],2:[function(e,t,o){!function(e,t){e.Collection=Backbone.Collection.extend({initialize:function(){this.lookup={}},create:function(e,t){t=t||{},t.url=this.url(),Backbone.Collection.prototype.create.call(this,e,t)},copy:function(){var e=new this.constructor;return e.urlRoot=this.urlRoot,e.model=this.model,e.lookup=_.extend({},this.lookup),void 0!==this.lookup.where&&(e.lookup.where=this.lookup.where.copy()),void 0!==this.lookup.columns&&(e.lookup.columns=this.lookup.columns.slice(0)),this.lookup.order&&"object"==typeof this.lookup.order&&(e.lookup.order=this.lookup.order.slice(0)),e},fetchCount:function(e){var t=this.copy();return e.data?e.data.returning="count":e.data={returning:"count"},t.fetch(e)},fetch:function(e){e=e||{};var t={},o=void 0;return this.lookup.where?o=this.lookup.where.and(e.where):e.where&&(o=e.where),o&&!o.isNull()&&(t.where=o.toJSON()),(e.limit||this.lookup.limit)&&(t.limit=e.limit||this.lookup.limit),(e.order||this.lookup.order)&&(t.order=e.order||this.lookup.order),(e.expand||this.lookup.expand)&&(t.expand=e.expand||this.lookup.expand),_.isEmpty(t)||(e.data=_.extend({lookup:JSON.stringify(t)},e.data)),Backbone.Collection.prototype.fetch.call(this,e)},fetchOne:function(e){e=e||{};var t=this.copy(),o=_.extend({},e,{limit:1,success:function(t,o){e.success&&(t.length?e.success(t.at(0),o):e.success(void 0,o))}});return t.fetch(o)},refine:function(e){var t=this.copy();return t.lookup.where?t.lookup.where=t.lookup.where.and(e.where):e.where&&(t.lookup.where=e.where),delete e.where,t.lookup=_.extend(t.lookup,e),t},url:function(){var e="string"==typeof this.urlRoot?this.urlRoot:this.urlRoot();return this.lookup.view?s.rtrim(e,"/")+"/"+this.lookup.view:e}})}(window.orb,jQuery)},{}],3:[function(e,t,o){!function(e,t){e.Model=Backbone.Model.extend({initialize:function(e){if(e=e||{},this.schema){var t={};_.each(this.schema.columns||[],function(e){void 0!==e["default"]&&(t[e.field]=e["default"])}),e=_.extend(t,e)}this.references={},Backbone.Model.prototype.initialize.call(this,e)},addCollection:function(e,t,o){o=o||{};var n=this,i=this.get(e),r=_.isEmpty(i)?new t.collection:new t.collection(_.map(i,function(e){new t(e)}));return r.model=t,o.urlRoot?r.urlRoot=o.urlRoot:r.urlRoot=function(){return s.rtrim(n.urlRoot,"/")+"/"+n.get("id")+"/"+(o.urlSuffix||e)},this[e]=r,r},addReference:function(e,t,o){o=o||{};var n=this,i=o.getter||"get"+e[0].toUpperCase()+e.slice(1),r=o.setter||"set"+e[0].toUpperCase()+e.slice(1),u=o.field||s.underscored(e)+"_id";n[i]=function(){if(!n.references[e])if(o.reverseLookup){var i=new t;i.urlRoot=this.url()+"/"+e,n.references[e]=i}else{var r=_.extend({id:n.get(u)},n.get(e));n.references[e]=new t(r)}return n.references[e]},n[r]=function(t){n.references[e]=t,n.set(u,t?t.get("id"):null)}},clearReference:function(e){delete this.references[e]},url:function(){if(this.collection){var e=this.get("id");return e?this.collection.url()+"/"+e:this.collection.url()}return Backbone.Model.prototype.url.call(this)}},{schema:void 0,collection:e.Collection,all:function(e){return this.select(e)},select:function(e){var t=new this.collection;return t.lookup=_.extend({},t.lookup,e),t.urlRoot=this.prototype.urlRoot,t.model=this,t},byId:function(t,o){o=o||{};var n=new e.Q("id").is(t);return o.where=n.and(o.where),this.select().fetchOne(o)}})}(window.orb)},{}],4:[function(e,t,o){!function(e){e.Q=Backbone.Model.extend({defaults:{op:"==",column:void 0,table:"",caseSensitive:!1,functions:void 0,math:void 0,inverted:!1,value:void 0},initialize:function(e){"string"==typeof e&&this.set("column",e),void 0===this.get("functions")&&this.set("functions",[]),void 0===this.get("math")&&this.set("math",[])},after:function(t){var o=this.copy();return o.set("op",e.Q.Op.After),o.set("value",t),o},abs:function(){var e=this.copy();return e.modify(this.Function.Abs),e},and:function(t){return void 0===t||t.isNull()?this:this.isNull()?t:new e.QCompound({op:e.Q.Op.And,queries:[this,t]})},asString:function(){var t=this.copy();return t.modify(e.Q.Op.AsString),t},before:function(t){var o=this.copy();return o.set("op",e.Q.Op.Before),o.set("value",t),o},between:function(t,o){var n=this.copy();return n.set("op",e.Q.Op.Between),n.set("value",[t,o]),n},contains:function(t,o){var o=void 0===o?!1:o,n=this.copy();return n.set("op",e.Q.Op.Contains),n.set("value",t),n.set("caseSensitive",o),n},copy:function(){var t=_.extend({},this.attributes);return t.functions=t.functions.slice(0),t.math=t.math.slice(0),new e.Q(t)},doesNotContain:function(t,o){var o=void 0===o?!1:o,n=this.copy();return n.set("op",e.Q.Op.DoesNotContain),n.set("value",t),n.set("caseSensitive",o),n},doesNotEndwith:function(t,o){o=void 0===o?!1:o;var n=this.copy();return n.set("op",e.Q.Op.DoesNotEndwith),n.set("value",t),n.set("caseSensitive",o),n},doesNotMatch:function(t,o){var o=void 0===o?!1:o,n=this.copy();return n.set("op",e.Q.Op.DoesNotMatch),n.set("value",t),n.set("caseSensitive",o),n},doesNotStartwith:function(t,o){o=void 0===o?!1:o;var n=this.copy();return n.set("op",e.Q.Op.DoesNotStartwith),n.set("value",t),n.set("caseSensitive",o),n},endswith:function(t){var o=this.copy();return o.set("op",e.Q.Op.Endswith),o.set("value",t),o},greaterThan:function(t){var o=this.copy();return o.set("op",e.Q.Op.GreaterThan),o.set("value",t),o},greaterThanOrEqual:function(t){var o=this.copy();return o.set("op",e.Q.Op.GreaterThanOrEqual),o.set("value",t),o},is:function(t){var o=this.copy();return o.set("op",e.Q.Op.Is),o.set("value",t),o},isNot:function(t){var o=this.copy();return o.set("op",e.Q.Op.IsNot),o.set("value",t),o},isNull:function(){return void 0===this.get("column")||void 0===this.get("value")},isUndefined:function(){return void 0===this.get("value")},"in":function(t){var o=this.copy();return o.set("op",e.Q.Op.IsIn),o.set("value",t.slice(0)),o},notIn:function(t){var o=this.copy();return o.set("op",e.Q.Op.IsNotIn),o.set("value",t.slice(0)),o},lessThan:function(t){var o=this.copy();return o.set("op",e.Q.Op.LessThan),o.set("value",t.slice(0)),o},lessThanOrEqual:function(t){var o=this.copy();return o.set("op",e.Q.Op.LessThanOrEqual),o.set("value",t),o},lower:function(){var e=this.copy();e.modify(this.Function.Lower)},matches:function(t,o){var o=void 0===o?!0:o,n=this.copy();return n.set("op",e.Q.Op.Matches),n.set("value",t),n.set("caseSensitive",o),n},modify:function(e){this.get("functions").push(e)},or:function(t){return void 0===t||t.isNull()?this:this.isNull()?t:new e.QCompound({op:e.Q.Op.Or,queries:[this,t]})},startswith:function(t){var o=this.copy();return o.set("op",e.Q.Op.Startswith),o.set("value",t),o},toJSON:function(){var t={type:"query",column:this.get("column"),op:e.Q.Op.key(this.get("op")),value:this.get("value")},o=this.get("functions");if(!_.isEmpty(o)){var n=[];_.each(o,function(t){n.push(e.Q.Function.key(t))}),t.functions=n}var i=this.get("math");if(!_.isEmpty(i)){var r=[];_.each(i,function(t){r.push(e.Q.Math.key(t))}),t.math=r}return t},upper:function(){var e=this.copy();e.modify(this.Funtions.Upper)}},{Op:{Is:"==",IsNot:"!=",LessThan:"<",LessThanOrEqual:"<=",Before:"<",GreaterThan:">",GreaterThanOrEqual:">=",After:">",Between:"between",Contains:"contains",DoesNotContain:"doesn't contain",Startswith:"startswith",Endswith:"endswith",Matches:"matches",DoesNotMatch:"doesn't match",IsIn:"is in",IsNotIn:"is not in",DoesNotStartwith:"doesn't startwith",DoesNotEndwith:"doesn't endwith",And:"and",Or:"or",key:function(e){var t=void 0;return _.find(this,function(o,n){return o===e?(t=n,!0):!1}),t}},Math:{Add:"+",Subtract:"-",Multiply:"*",Divide:"/",And:"&",Or:"|",key:function(e){var t=void 0;return _.find(this,function(o,n){return o===e?(t=n,!0):!1}),t}},Function:{Lower:"lower",Upper:"upper",Abs:"abs",AsString:"str",key:function(e){var t=void 0;return _.find(this,function(o,n){return o===e?(t=n,!0):!1}),t}}}),e.QCompound=Backbone.Model.extend({defaults:{op:"And"},initialize:function(t){t=t||{},this.queries=t.queries||new e.Collection},and:function(t){if(void 0===t||t.isNull())return this;if(this.isNull())return t;if(this.get("op")===e.Q.Op.And){var o=this.queries.slice(0);return o.push(t),new e.QCompound({op:e.Q.Op.And,queries:o})}return new e.QCompound({op:e.Q.Op.And,queries:new Backbone.Collection([this,t])})},copy:function(){var t={op:this.get("op"),queries:this.queries.slice(0)};return new e.QCompound(t)},isNull:function(){var e=!0;return _.each(this.queries,function(t){t.isNull()||(e=!1)}),e},or:function(t){if(void 0===t||t.isNull())return this;if(this.isNull())return t;if(this.get("op")===e.Q.Op.Or){var o=this.queries.slice(0);return o.push(t),new e.QCompound({op:e.Q.Op.Or,queries:o})}return new e.QCompound({op:e.Q.Op.Or,queries:[this,t]})},toJSON:function(){return{type:"compound",op:e.Q.Op.key(this.get("op")),queries:this.queries.toJSON()}}})}(window.orb)},{}],5:[function(e,t,o){!function(e,t){e.Index=Backbone.Model.extend({defaults:{name:"",dbname:"",unique:!1,order:void 0,cached:!1,timeout:0},initialize:function(){this.columns=new Backbone.Collection({model:e.Column})},toJSON:function(){return{name:this.get("name"),dbname:this.get("dbname"),unique:this.get("unique"),order:this.get("order"),cached:this.get("cached"),timeout:this.get("timeout")}}}),e.Pipe=Backbone.Model.extend({defaults:{name:"",through:"",from:"",to:"",unique:!1},toJSON:function(){return{name:this.get("name"),through:this.get("through"),from:this.get("from"),to:this.get("to"),unique:this.get("unique")}}}),e.Column=Backbone.Model.extend({defaults:{name:"",field:"",display:"",index:void 0,flags:0,"default":void 0,defaultOrder:"asc",type:""},testFlag:function(e){return(self.get("flags")&e)>0},toJSON:function(){var e=this.get("index"),t=void 0;return e&&(t={name:e.get("name"),cached:e.get("cached"),timeout:e.get("timeout")}),{type:this.get("type"),name:this.get("name"),field:this.get("field"),display:this.get("display"),flags:this.get("flags"),defaultOrder:this.get("defaultOrder"),"default":this.get("default"),index:t}}},{Flags:{ReadOnly:Math.pow(2,0),Private:Math.pow(2,1),Polymorphic:Math.pow(2,2),Primary:Math.pow(2,3),Autoincrement:Math.pow(2,4),Required:Math.pow(2,5),Unique:Math.pow(2,6),Encrypted:Math.pow(2,7),Searchable:Math.pow(2,8),Translatable:Math.pow(2,9),CaseSensitive:Math.pow(2,10),Virtual:Math.pow(2,11),Queryable:Math.pow(2,12)}}),e.Schema=Backbone.Model.extend({defaults:{name:"","abstract":!1,dbname:"",display:"",inherits:""},initialize:function(){this.columns=new Backbone.Collection({model:e.Column}),this.columns.comparator=function(e){return e.get("name")},this.indexes=new Backbone.Collection({model:e.Index}),this.indexes.comparator=function(e){return e.get("name")},this.pipes=new Backbone.Collection({model:e.Pipe}),this.pipes.comparator=function(e){return e.get("name")}},toJSON:function(){return{name:this.get("name"),"abstract":this.get("abstract"),dbname:this.get("dbname"),display:this.get("display"),inherits:this.get("inherits"),columns:this.columns.toJSON(),indexes:this.indexes.toJSON(),pipes:this.pipes.toJSON()}}})}(window.orb,jQuery)},{}]},{},[1]);
