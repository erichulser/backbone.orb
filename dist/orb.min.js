!function e(t,n,o){function i(s,c){if(!n[s]){if(!t[s]){var a="function"==typeof require&&require;if(!c&&a)return a(s,!0);if(r)return r(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){var n=t[s][1][e];return i(n?n:e)},l,l.exports,e,t,n,o)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<o.length;s++)i(o[s]);return i}({1:[function(e,t,n){window.orb={ready:function(e,t){t=t||{};var n=t.scope||{};$.getJSON({url:e+"?returning=schema",type:"GET",dataType:"json",crossDomain:!0,processData:!1,contentType:"application/json",success:function(e){_.each(e,function(e){var t={};e.referenceScope=n,_.each(e.columns,function(e,n){"Id"!==e.type&&(t[n]=e["default"])}),n[e.model]=orb.Model.extend({urlRoot:e.urlRoot,defaults:t},{schema:e})}),void 0!==t.success&&t.success(n)},error:t.error})}},e("./context"),e("./schema"),e("./collection"),e("./model"),e("./queries")},{"./collection":2,"./context":3,"./model":4,"./queries":5,"./schema":6}],2:[function(e,t,n){!function(e,t){e.Collection=Backbone.Collection.extend({initialize:function(t){t=t||{},this.context=new e.Context(t)},create:function(e,t){t=t||{},t.url=this.url(),Backbone.Collection.prototype.create.call(this,e,t)},copy:function(){var e=new this.constructor;return e.urlRoot=this.urlRoot,e.model=this.model,e.context=_.extend({},this.context),void 0!==this.context.where&&(e.context.where=this.context.where.copy()),void 0!==this.context.columns&&(e.context.columns=this.context.columns.slice(0)),this.context.order&&"object"==typeof this.context.order&&(e.context.order=this.context.order.slice(0)),e},fetchCount:function(e){var t=this.copy();return e.data?e.data.returning="count":e.data={returning:"count"},t.fetch(e)},fetch:function(t){t=t||{};var n=new e.Context(_.clone(this.context.attributes));return n.merge(t),_.isEmpty(n)||(t.data=_.extend({},t.data,{context:JSON.stringify(n.toJSON())})),Backbone.Collection.prototype.fetch.call(this,t)},fetchOne:function(e){e=e||{};var t=this.copy(),n=_.extend({},e,{limit:1,success:function(t,n){e.success&&(t.length?e.success(t.at(0),n):e.success(void 0,n))}});return t.fetch(n)},refine:function(e){var t=this.copy();return t.context.merge(this.context.attributes),t.context.merge(e),t},url:function(){var e="string"==typeof this.urlRoot?this.urlRoot:this.urlRoot();return this.context.get("view")?s.rtrim(e,"/")+"/"+this.context.get("view"):e}})}(window.orb,jQuery)},{}],3:[function(e,t,n){!function(e){var t={autoIncrementEnabled:!0,columns:void 0,db:void 0,database:void 0,distinct:!1,disinctOn:"",dryRun:!1,expand:void 0,format:"json",force:!1,inflated:!0,limit:void 0,locale:void 0,namespace:"",order:void 0,page:void 0,pageSize:void 0,scope:void 0,returning:"records",start:void 0,timezone:void 0,where:void 0};e.Context=Backbone.Model.extend({merge:function(e){var t=this;_.each(e,function(e,n){if("where"===n){var o=t.get("where");o=o?o.and(e):e,t.set("where",o)}else if("expand"===n){var i=t.get("expand");i?i.extend(e):this.set("expand",e)}else t.set(n,e)})},set:function(e,n){var o;o=_.isObject(e)?e:{key:n};var i={};_.each(o,function(e,n){"expand"===n&&e instanceof string&&(e=e.split(",")),_.hasOwnProperty(n,t)&&(i[n]=e)}),Backbone.Model.prototype.set.call(this,i)},toJSON:function(){var e=_.clone(this.attributes);return e.where&&(e.where=e.where.toJSON()),e}})}(window.orb)},{}],4:[function(e,t,n){!function(e,t){e.Model=Backbone.Model.extend({initialize:function(e){var t=this;e=e||{},t.references={};var n=t.constructor.schema;n&&(_.each(n.columns,function(e){"Reference"===e.type&&(t.references[e.name]=void 0)}),_.each(n.collectors,function(e){if(e.flags.Unique)t.references[e.name]=void 0;else{var o=n.referenceScope[e.model],i=new o.collection;i.urlRoot=function(){var e=t.urlRoot,n=t.get("id");if(e&&n){var o=s.trim(t.urlRoot,"/");return o+"/"+n}},t[e.name]=i}})),Backbone.Model.prototype.initialize.call(this,e)},get:function(e){var t=this,n=this.constructor.schema;if(n){var o=n.collectors[e],i=void 0;if(_.each(n.columns,function(t){"Reference"===t.type&&t.name===e&&(i=t)}),i&&"Reference"===i.type){var r=this.references[e];return void 0===r&&(r=new n.referenceScope[i.reference]({id:t.attributes[i.field]}),this.references[i.name]=r),r}if(o){if(o.flags.Unique){var r=this.references[e];return void 0===r&&(r=new n.referenceScope[o.model],r.urlRoot=this.url()+"/"+name,this.references[e]=r),r}return this[e]}return Backbone.Model.prototype.get.call(this,e)}return Backbone.Model.prototype.get.call(this,e)},parse:function(e,t){var n=this,o=n.constructor.schema;return o&&(_.each(o.columns,function(t){if("Reference"===t.type){var i=e[t.name];delete e[t.name],void 0!==i&&(n.references[t.name]?n.references[t.name].update(i):n.references[t.name]=new o.referenceScope[t.reference](i))}}),_.each(o.collectors,function(t){var i=e[t.name];if(delete e[t.name],i)if(t.flags.Unique)n.references[t.name]?n.references[collctor.name].update(i):n.references[t.name]=new o.referenceScope[t.model](i);else{var r=void 0;r=i instanceof Array?i:i.records,void 0!==r&&n[t.name].set(r)}})),Backbone.Model.prototype.parse.call(this,e,t)},set:function(t,n){var o=this;return _.each(t,function(n,i){if(_.hasOwnProperty(o.references,i))if(delete t[i],n instanceof e.Model)o.references[i]=n;else{var r=o.get(i);r.update(n)}else _.hasOwnProperty(o,i)&&(delete t[i],n instanceof e.Collection?o[i]=n:o[i].set(n))}),Backbone.Model.prototype.set.call(this,t,n)},unset:function(e,t){if(void 0!==this.references[name]){t=t||{};var n=this.references[name];delete n,t.silent||this.trigger("change:"+name,n)}else void 0!==this[e]?this[e].reset():Backbone.Model.prototype.unset.call(this,e,t)},url:function(){if(this.collection){var e=this.get("id");return e?this.collection.url()+"/"+e:this.collection.url()}return Backbone.Model.prototype.url.call(this)}},{schema:void 0,collection:e.Collection,all:function(e){return this.select(e)},select:function(e){var t=new this.collection(e);return t.urlRoot=this.prototype.urlRoot,t.model=this,t},byId:function(t,n){n=n||{};var o=new e.Q("id").is(t);return n.where=o.and(n.where),this.select().fetchOne(n)}})}(window.orb)},{}],5:[function(e,t,n){!function(e){e.Q=Backbone.Model.extend({defaults:{op:"==",column:void 0,table:"",caseSensitive:!1,functions:void 0,math:void 0,inverted:!1,value:void 0},initialize:function(e){"string"==typeof e&&this.set("column",e),void 0===this.get("functions")&&this.set("functions",[]),void 0===this.get("math")&&this.set("math",[])},after:function(t){var n=this.copy();return n.set("op",e.Q.Op.After),n.set("value",t),n},abs:function(){var e=this.copy();return e.modify(this.Function.Abs),e},and:function(t){return void 0===t||t.isNull()?this:this.isNull()?t:new e.QCompound({op:e.Q.Op.And,queries:[this,t]})},asString:function(){var t=this.copy();return t.modify(e.Q.Op.AsString),t},before:function(t){var n=this.copy();return n.set("op",e.Q.Op.Before),n.set("value",t),n},between:function(t,n){var o=this.copy();return o.set("op",e.Q.Op.Between),o.set("value",[t,n]),o},contains:function(t,n){var n=void 0===n?!1:n,o=this.copy();return o.set("op",e.Q.Op.Contains),o.set("value",t),o.set("caseSensitive",n),o},copy:function(){var t=_.extend({},this.attributes);return t.functions=t.functions.slice(0),t.math=t.math.slice(0),new e.Q(t)},doesNotContain:function(t,n){var n=void 0===n?!1:n,o=this.copy();return o.set("op",e.Q.Op.DoesNotContain),o.set("value",t),o.set("caseSensitive",n),o},doesNotEndwith:function(t,n){n=void 0===n?!1:n;var o=this.copy();return o.set("op",e.Q.Op.DoesNotEndwith),o.set("value",t),o.set("caseSensitive",n),o},doesNotMatch:function(t,n){var n=void 0===n?!1:n,o=this.copy();return o.set("op",e.Q.Op.DoesNotMatch),o.set("value",t),o.set("caseSensitive",n),o},doesNotStartwith:function(t,n){n=void 0===n?!1:n;var o=this.copy();return o.set("op",e.Q.Op.DoesNotStartwith),o.set("value",t),o.set("caseSensitive",n),o},endswith:function(t){var n=this.copy();return n.set("op",e.Q.Op.Endswith),n.set("value",t),n},greaterThan:function(t){var n=this.copy();return n.set("op",e.Q.Op.GreaterThan),n.set("value",t),n},greaterThanOrEqual:function(t){var n=this.copy();return n.set("op",e.Q.Op.GreaterThanOrEqual),n.set("value",t),n},is:function(t){var n=this.copy();return n.set("op",e.Q.Op.Is),n.set("value",t),n},isNot:function(t){var n=this.copy();return n.set("op",e.Q.Op.IsNot),n.set("value",t),n},isNull:function(){return void 0===this.get("column")||void 0===this.get("value")},isUndefined:function(){return void 0===this.get("value")},"in":function(t){var n=this.copy();return n.set("op",e.Q.Op.IsIn),n.set("value",t.slice(0)),n},notIn:function(t){var n=this.copy();return n.set("op",e.Q.Op.IsNotIn),n.set("value",t.slice(0)),n},lessThan:function(t){var n=this.copy();return n.set("op",e.Q.Op.LessThan),n.set("value",t.slice(0)),n},lessThanOrEqual:function(t){var n=this.copy();return n.set("op",e.Q.Op.LessThanOrEqual),n.set("value",t),n},lower:function(){var e=this.copy();e.modify(this.Function.Lower)},matches:function(t,n){var n=void 0===n?!0:n,o=this.copy();return o.set("op",e.Q.Op.Matches),o.set("value",t),o.set("caseSensitive",n),o},modify:function(e){this.get("functions").push(e)},or:function(t){return void 0===t||t.isNull()?this:this.isNull()?t:new e.QCompound({op:e.Q.Op.Or,queries:[this,t]})},startswith:function(t){var n=this.copy();return n.set("op",e.Q.Op.Startswith),n.set("value",t),n},toJSON:function(){var t={type:"query",column:this.get("column"),op:e.Q.Op.key(this.get("op")),value:this.get("value")},n=this.get("functions");if(!_.isEmpty(n)){var o=[];_.each(n,function(t){o.push(e.Q.Function.key(t))}),t.functions=o}var i=this.get("math");if(!_.isEmpty(i)){var r=[];_.each(i,function(t){r.push(e.Q.Math.key(t))}),t.math=r}return t},upper:function(){var e=this.copy();e.modify(this.Funtions.Upper)}},{Op:{Is:"==",IsNot:"!=",LessThan:"<",LessThanOrEqual:"<=",Before:"<",GreaterThan:">",GreaterThanOrEqual:">=",After:">",Between:"between",Contains:"contains",DoesNotContain:"doesn't contain",Startswith:"startswith",Endswith:"endswith",Matches:"matches",DoesNotMatch:"doesn't match",IsIn:"is in",IsNotIn:"is not in",DoesNotStartwith:"doesn't startwith",DoesNotEndwith:"doesn't endwith",And:"and",Or:"or",key:function(e){var t=void 0;return _.find(this,function(n,o){return n===e?(t=o,!0):!1}),t}},Math:{Add:"+",Subtract:"-",Multiply:"*",Divide:"/",And:"&",Or:"|",key:function(e){var t=void 0;return _.find(this,function(n,o){return n===e?(t=o,!0):!1}),t}},Function:{Lower:"lower",Upper:"upper",Abs:"abs",AsString:"str",key:function(e){var t=void 0;return _.find(this,function(n,o){return n===e?(t=o,!0):!1}),t}}}),e.QCompound=Backbone.Model.extend({defaults:{op:"and"},initialize:function(t){t=t||{},this.queries=t.queries||new e.Collection},and:function(t){if(void 0===t||t.isNull())return this;if(this.isNull())return t;if(this.get("op")===e.Q.Op.And){var n=this.queries.slice(0);return n.push(t),new e.QCompound({op:e.Q.Op.And,queries:n})}return new e.QCompound({op:e.Q.Op.And,queries:new Backbone.Collection([this,t])})},copy:function(){var t={op:this.get("op"),queries:this.queries.slice(0)};return new e.QCompound(t)},isNull:function(){var e=!0;return this.queries.each(function(t){t.isNull()||(e=!1)}),e},or:function(t){if(void 0===t||t.isNull())return this;if(this.isNull())return t;if(this.get("op")===e.Q.Op.Or){var n=this.queries.slice(0);return n.push(t),new e.QCompound({op:e.Q.Op.Or,queries:n})}return new e.QCompound({op:e.Q.Op.Or,queries:[this,t]})},toJSON:function(){return{type:"compound",op:e.Q.Op.key(this.get("op")),queries:this.queries.toJSON()}}})}(window.orb)},{}],6:[function(e,t,n){!function(e,t){e.Index=Backbone.Model.extend({defaults:{name:"",dbname:"",unique:!1,order:void 0,cached:!1,timeout:0},initialize:function(){this.columns=new Backbone.Collection({model:e.Column})},toJSON:function(){return{name:this.get("name"),dbname:this.get("dbname"),unique:this.get("unique"),order:this.get("order"),cached:this.get("cached"),timeout:this.get("timeout")}}}),e.Pipe=Backbone.Model.extend({defaults:{name:"",through:"",from:"",to:"",unique:!1},toJSON:function(){return{name:this.get("name"),through:this.get("through"),from:this.get("from"),to:this.get("to"),unique:this.get("unique")}}}),e.Column=Backbone.Model.extend({defaults:{type:"",name:"",field:"",display:"",reference:void 0,index:void 0,flags:0,"default":void 0,defaultOrder:"asc"},testFlag:function(e){return(self.get("flags")&e)>0},toJSON:function(){var e=this.get("index"),t=void 0;return e&&(t={name:e.get("name"),cached:e.get("cached"),timeout:e.get("timeout")}),{type:this.get("type"),name:this.get("name"),field:this.get("field"),display:this.get("display"),flags:this.get("flags"),defaultOrder:this.get("defaultOrder"),"default":this.get("default"),index:t}}},{Flags:{ReadOnly:Math.pow(2,0),Private:Math.pow(2,1),Polymorphic:Math.pow(2,2),Primary:Math.pow(2,3),Autoincrement:Math.pow(2,4),Required:Math.pow(2,5),Unique:Math.pow(2,6),Encrypted:Math.pow(2,7),Searchable:Math.pow(2,8),Translatable:Math.pow(2,9),CaseSensitive:Math.pow(2,10),Virtual:Math.pow(2,11),Queryable:Math.pow(2,12)}}),e.Schema=Backbone.Model.extend({defaults:{name:"","abstract":!1,dbname:"",display:"",inherits:"",type:""},initialize:function(){this.columns=new Backbone.Collection,this.columns.comparator=function(e){return e.get("name")},this.indexes=new Backbone.Collection,this.indexes.comparator=function(e){return e.get("name")},this.pipes=new Backbone.Collection,this.pipes.comparator=function(e){return e.get("name")}},toJSON:function(){return{name:this.get("name"),"abstract":this.get("abstract"),dbname:this.get("dbname"),display:this.get("display"),inherits:this.get("inherits"),columns:this.columns.toJSON(),indexes:this.indexes.toJSON(),pipes:this.pipes.toJSON()}}})}(window.orb,jQuery)},{}]},{},[1]);
