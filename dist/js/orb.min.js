!function e(t,n,o){function i(s,c){if(!n[s]){if(!t[s]){var a="function"==typeof require&&require;if(!c&&a)return a(s,!0);if(r)return r(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){var n=t[s][1][e];return i(n?n:e)},l,l.exports,e,t,n,o)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<o.length;s++)i(o[s]);return i}({1:[function(e,t,n){window.orb={ready:function(e,t){t=t||{};var n,o=t.scope||{},i=e+"?returning=schema";n=t.crossDomain?$.getJSON({url:i,type:"GET",dataType:"json",contentType:"application/json",crossDomain:!0,processData:!1,error:t.error}):$.get(i,{contentType:"application/json",error:t.error}),n.success(function(e){_.each(e,function(e){o[e.model]=orb.Schema.generateModel({schema:e,scope:o})}),void 0!==t.success&&t.success(o)})}},e("./context"),e("./schema"),e("./collection"),e("./model"),e("./queries")},{"./collection":2,"./context":3,"./model":4,"./queries":5,"./schema":6}],2:[function(e,t,n){!function(e,t){e.Collection=Backbone.Collection.extend({initialize:function(t){t=t||{},this.urlRoot=t.urlRoot||void 0,this.name=t.name||void 0,this.source=t.source||void 0,this.context=new e.Context(t),Backbone.Collection.prototype.initialize.call(this,t)},create:function(e,t){t=t||{},t.url=this.url(),Backbone.Collection.prototype.create.call(this,e,t)},clone:function(){var e=Backbone.Collection.prototype.clone.call(this);return e.context=this.context.clone(),e.name=this.name,e.source=this.source,e.urlRoot=this.urlRoot,e},fetch:function(t){t=t||{};var n=new e.Context(_.clone(this.context.attributes));return n.merge(t),_.isEmpty(n)||(t.data=_.extend({},t.data,{orb_context:JSON.stringify(n.toJSON())})),Backbone.Collection.prototype.fetch.call(this,t)},fetchCount:function(n){n=n||{};var o=this,i=new e.Context(_.extend({},_.clone(this.context.attributes),{returning:"count"}));i.merge(n);var r=_.extend({},n,{method:"get",url:this.url(),data:_.extend({},n.data,{orb_context:JSON.stringify(i.toJSON())}),success:function(e){n.success&&n.success(o,e.count)}});return t.ajax(r)},fetchOne:function(n){n=n||{};var o=this,i=new e.Context(_.extend({},_.clone(this.context.attributes),{limit:1}));i.merge(n);var r=_.extend({},n,{method:"get",limit:1,url:this.url(),data:_.extend({},n.data,{orb_context:JSON.stringify(i.toJSON())}),success:function(e){if(n.success){var t=e.length?e[0]:{},i=o.model||Bakcbone.Model;n.success(new i(t),t)}}});return t.ajax(r)},parse:function(e,t){if(e instanceof Array||e instanceof Backbone.Collection||e instanceof Backbone.Model)return e;if(void 0!==e.records)return e.records;var n=[],o=this.constructor.model||Backbone.Model;if(e.count||e.ids){var i=void 0===e.ids,r=e.count||e.ids.length;n=_.times(r,function(t){return i?void 0:{id:e.ids[t]}}),void 0!==e.first&&(n[0]=new o(e.first)),void 0!==e.last&&(n[n.length-1]=new o(e.last))}else void 0!==e.first&&n.push(new o(e.first)),void 0!==e.last&&n.push(new o(e.last));return n},refine:function(e){var t=this.clone();return t.context.merge(this.context.attributes),t.context.merge(e),t},toJSON:function(){var e=this,t=[];return e.each(function(e){var n=e.modifiedAttributes();e.isNew()||(n[e.idAttribute]=e.id),t.push(n)}),t},save:function(e){var n=this.url(),o=this.toJSON(),i=this;return e=e||{},t.ajax(_.extend({},e,{type:"put",url:n,data:JSON.stringify({records:o}),success:function(t){i.each(function(e,n){e.set(e.parse(t[n]))}),e.success&&e.success(i,t)}}))},url:function(){if(this.source&&this.name){var e=this.source.urlRoot;if(e){var t=this.source.get("id");if(t){var n=s.trim(e,"/");return[n,t,this.name].join("/")}return e}}return this.urlRoot}})}(window.orb,jQuery)},{}],3:[function(e,t,n){!function(e){var t={autoIncrementEnabled:!0,columns:void 0,db:void 0,database:void 0,distinct:!1,disinctOn:"",dryRun:!1,expand:void 0,format:"json",force:!1,inflated:!0,limit:void 0,locale:void 0,namespace:"",order:void 0,page:void 0,pageSize:void 0,scope:void 0,returning:"records",start:void 0,timezone:void 0,where:void 0};e.Context=Backbone.Model.extend({clone:function(){var e=Backbone.Model.prototype.clone.call(this);return void 0!==e.attributes.columns&&(e.attributes.columns=e.attributes.columns.slice(0)),void 0!==e.attributes.order&&"object"==typeof e.attributes.order&&(e.attributes.order=e.attributes.order.slice(0)),void 0!==e.attributes.where&&(e.attributes.where=e.attributes.where.clone()),e},merge:function(e){var t=this;_.each(e,function(e,n){if("where"===n){var o=t.get("where");o=o?o.and(e):e,t.set("where",o)}else if("expand"===n){var i=t.get("expand");i?i.extend(e):t.set("expand",e)}else t.set(n,e)})},set:function(e,n){var o;_.isObject(e)?o=e:(o={},o[e]=n);var i={};_.each(o,function(e,n){"expand"===n&&"string"==typeof e&&(e=e.split(",")),-1!==_.keys(t).indexOf(n)&&(i[n]=e)}),Backbone.Model.prototype.set.call(this,i)},toJSON:function(){var e=_.clone(this.attributes);return e.where&&(e.where=e.where.toJSON()),e}})}(window.orb)},{}],4:[function(e,t,n){!function(e,t){e.Model=Backbone.Model.extend({initialize:function(e){var t=this,n=t.constructor.schema;t.baseAttributes=_.clone(t.defaults),t._initialized||(t._initialized=!0,t.references={},t.collections={},e=e||{},n&&(_.each(n.columns,function(e){"Reference"===e.type&&(t.references[e.name]=void 0)}),_.each(n.collectors,function(e){if(!e.flags.Static)if(e.flags.Unique)t.references[e.name]=void 0;else{var o,i=n.referenceScope[e.model];i?(o=new i.collection,o.source=t,o.name=e.name):(e.model&&console.log("[ORB Error] Could not find model: "+e.model),o=new Backbone.Collection,o.url=function(){return[s.trim(t.urlRoot,"/"),t.get("id"),e.name].join("/")}),t.collections[e.name]=o,t[e.name]=o}}))),n&&_.each(t.attributes,function(e,o){if(_.has(t.references,o))if(delete t.attributes[o],void 0===t.references[o]){var i=void 0;_.each(n.columns,function(e){e.name===o&&(i=n.referenceScope[e.reference])}),void 0===i&&(console.log("[ORB Error] Could not find model for: "+n.model+"."+o),i=Backbone.Model),e instanceof i?t.references[o]=e:t.references[o]=new i(e)}else t.references[o].set(e);else if(_.has(t.collections,o))if(delete t.attributes[o],e instanceof Backbone.Collection)t.collections[o]=e;else{var r=t.collections[o];r.set(r.parse(e))}}),Backbone.Model.prototype.initialize.call(this,e)},fetch:function(t){t=t||{};var n=new e.Context;n.merge(t),_.isEmpty(n)||(t.data=_.extend({},t.data,{orb_context:JSON.stringify(n.toJSON())})),Backbone.Model.prototype.fetch.call(this,t)},get:function(e){var t=e.split(".");e=t[0];var n=this,o=this.constructor.schema;if(o){var i=o.collectors[e],r=void 0,s=void 0;if(_.each(o.columns,function(t){"Reference"===t.type&&t.name===e&&(r=t)}),r&&"Reference"===r.type){if(s=this.references[e],void 0===s){var c=n.attributes[r.field];c&&(s=new o.referenceScope[r.reference]({id:n.attributes[r.field]}),this.references[r.name]=s)}return t.length>1&&void 0!==s?s.get(t.slice(1).join(".")):s}return i?i.flags.Unique?(s=this.references[e],void 0===s&&(s=new o.referenceScope[i.model],s.urlRoot=this.url()+"/"+name,this.references[e]=s),s):this.collections[e]:Backbone.Model.prototype.get.call(this,e)}return Backbone.Model.prototype.get.call(this,e)},modifiedAttributes:function(){var e={},t=this,n=this.constructor.schema;return _.each(this.attributes,function(o,i){_.isEqual(o,t.baseAttributes[i])||n&&n.columns[i]&&n.columns[i].flags.ReadOnly||(e[i]=o)}),e},parse:function(e,t){void 0===this.references&&this.initialize();var n=this,o=n.constructor.schema;return o&&e&&(_.each(o.columns,function(t){if("Reference"===t.type){var i=e[t.name];delete e[t.name],void 0!==i&&(n.references[t.name]?n.references[t.name].set(i):n.references[t.name]=new o.referenceScope[t.reference](i))}}),_.each(o.collectors,function(t){var i=e[t.name];if(delete e[t.name],i)if(t.flags.Unique)n.references[t.name]?n.references[t.name].set(i):n.references[t.name]=new o.referenceScope[t.model](i);else{var r=n.collections[t.name];r.set(r.parse(i))}})),_.extend(this.baseAttributes,e),Backbone.Model.prototype.parse.call(this,e,t)},reset:function(){var e=this;_.each(e.baseAttributes,function(t,n){e.set(n,t)})},save:function(e,t){t=t||{};var n=_.clone(e||this.attributes),o=t.include||"",i=t.expand?[t.expand]:[],r=this;_.each(o.split(","),function(e){var t=r.collections[e];void 0!==t&&(n[e]=t.toJSON(),i.push(e))});var s=r.constructor.schema,c=r.isNew();return void 0!==s&&_.each(s.columns,function(e){e.flags.ReadOnly?(delete n[e.field],delete n[e.name]):c&&null===n[e.field]&&(delete n[e.field],delete n[e.name])}),i.length&&(n.orb_context={expand:i.join(",")}),t.attrs=n,Backbone.Model.prototype.save.call(this,e,t)},set:function(e,t){if(void 0!==t&&"string"==typeof e){var n={};n[e]=t,e=n}var o=this,i=this.constructor.schema;return _.each(e,function(t,n){if(_.has(o.references,n)){var r=void 0,s=void 0;_.each(i.columns,function(e){e.name===n&&(r=e.field,s=i.referenceScope[e.reference])}),delete e[n],t instanceof Object?(t instanceof Backbone.Model?o.references[n]=t:o.references[n]?o.references[n].set(t):s&&(o.references[n]=new s(t)),r&&t.id&&(e[r]=t.id)):(delete o.references[n],r&&(e[r]=t))}else if(_.has(o.collections,n))if(delete e[n],t instanceof Backbone.Collection)o.collections[n]=t;else{var c=o.collections[n];c.set(c.parse(t))}}),Backbone.Model.prototype.set.call(this,e)},unset:function(e,t){if(void 0!==this.references[name]){t=t||{};var n=this.references[name];return delete this.references[name],t.silent||this.trigger("change:"+name,n),!0}return void 0!==this.collections[e]?(this.collections[e].reset(),!0):Backbone.Model.prototype.unset.call(this,e,t)},url:function(){if(this.collection){var e=this.get("id");return e?this.collection.url()+"/"+e:this.collection.url()}return Backbone.Model.prototype.url.call(this)}},{schema:void 0,collection:e.Collection,all:function(e){return this.select(e)},select:function(e){var t=new this.collection(e);return t.urlRoot=this.prototype.urlRoot,t.model=this,t},byId:function(t,n){n=n||{};var o=new e.Q("id").is(t);return n.where=o.and(n.where),this.select().fetchOne(n)}})}(window.orb)},{}],5:[function(e,t,n){!function(e){e.Q=Backbone.Model.extend({defaults:{op:"==",column:void 0,table:"",caseSensitive:!1,functions:void 0,math:void 0,inverted:!1,value:void 0},initialize:function(e){"string"==typeof e&&this.set("column",e),void 0===this.get("functions")&&this.set("functions",[]),void 0===this.get("math")&&this.set("math",[])},after:function(t){var n=this.clone();return n.set("op",e.Q.Op.After),n.set("value",t),n},abs:function(){var e=this.clone();return e.modify(this.Function.Abs),e},and:function(t){return void 0===t||t.isNull()?this:this.isNull()?t:new e.QCompound({op:e.Q.Op.And,queries:[this,t]})},asString:function(){var t=this.clone();return t.modify(e.Q.Op.AsString),t},before:function(t){var n=this.clone();return n.set("op",e.Q.Op.Before),n.set("value",t),n},between:function(t,n){var o=this.clone();return o.set("op",e.Q.Op.Between),o.set("value",[t,n]),o},contains:function(t,n){var n=void 0===n?!1:n,o=this.clone();return o.set("op",e.Q.Op.Contains),o.set("value",t),o.set("caseSensitive",n),o},clone:function(){var t=_.extend({},this.attributes);return t.functions=t.functions.slice(0),t.math=t.math.slice(0),new e.Q(t)},doesNotContain:function(t,n){var n=void 0===n?!1:n,o=this.clone();return o.set("op",e.Q.Op.DoesNotContain),o.set("value",t),o.set("caseSensitive",n),o},doesNotEndwith:function(t,n){n=void 0===n?!1:n;var o=this.clone();return o.set("op",e.Q.Op.DoesNotEndwith),o.set("value",t),o.set("caseSensitive",n),o},doesNotMatch:function(t,n){var n=void 0===n?!1:n,o=this.clone();return o.set("op",e.Q.Op.DoesNotMatch),o.set("value",t),o.set("caseSensitive",n),o},doesNotStartwith:function(t,n){n=void 0===n?!1:n;var o=this.clone();return o.set("op",e.Q.Op.DoesNotStartwith),o.set("value",t),o.set("caseSensitive",n),o},endswith:function(t){var n=this.clone();return n.set("op",e.Q.Op.Endswith),n.set("value",t),n},greaterThan:function(t){var n=this.clone();return n.set("op",e.Q.Op.GreaterThan),n.set("value",t),n},greaterThanOrEqual:function(t){var n=this.clone();return n.set("op",e.Q.Op.GreaterThanOrEqual),n.set("value",t),n},is:function(t){var n=this.clone();return n.set("op",e.Q.Op.Is),n.set("value",t),n},isNot:function(t){var n=this.clone();return n.set("op",e.Q.Op.IsNot),n.set("value",t),n},isNull:function(){return void 0===this.get("column")||void 0===this.get("value")},isUndefined:function(){return void 0===this.get("value")},"in":function(t){var n=this.clone();return n.set("op",e.Q.Op.IsIn),n.set("value",t.slice(0)),n},notIn:function(t){var n=this.clone();return n.set("op",e.Q.Op.IsNotIn),n.set("value",t.slice(0)),n},lessThan:function(t){var n=this.clone();return n.set("op",e.Q.Op.LessThan),n.set("value",t.slice(0)),n},lessThanOrEqual:function(t){var n=this.clone();return n.set("op",e.Q.Op.LessThanOrEqual),n.set("value",t),n},lower:function(){var e=this.clone();e.modify(this.Function.Lower)},matches:function(t,n){var n=void 0===n?!0:n,o=this.clone();return o.set("op",e.Q.Op.Matches),o.set("value",t),o.set("caseSensitive",n),o},modify:function(e){this.get("functions").push(e)},or:function(t){return void 0===t||t.isNull()?this:this.isNull()?t:new e.QCompound({op:e.Q.Op.Or,queries:[this,t]})},startswith:function(t){var n=this.clone();return n.set("op",e.Q.Op.Startswith),n.set("value",t),n},toJSON:function(){var t={type:"query",column:this.get("column"),op:e.Q.Op.key(this.get("op")),value:this.get("value")},n=this.get("functions");if(!_.isEmpty(n)){var o=[];_.each(n,function(t){o.push(e.Q.Function.key(t))}),t.functions=o}var i=this.get("math");if(!_.isEmpty(i)){var r=[];_.each(i,function(t){r.push(e.Q.Math.key(t))}),t.math=r}return t},upper:function(){var e=this.clone();e.modify(this.Funtions.Upper)}},{Op:{Is:"==",IsNot:"!=",LessThan:"<",LessThanOrEqual:"<=",Before:"<",GreaterThan:">",GreaterThanOrEqual:">=",After:">",Between:"between",Contains:"contains",DoesNotContain:"doesn't contain",Startswith:"startswith",Endswith:"endswith",Matches:"matches",DoesNotMatch:"doesn't match",IsIn:"is in",IsNotIn:"is not in",DoesNotStartwith:"doesn't startwith",DoesNotEndwith:"doesn't endwith",And:"and",Or:"or",key:function(e){var t=void 0;return _.find(this,function(n,o){return n===e?(t=o,!0):!1}),t}},Math:{Add:"+",Subtract:"-",Multiply:"*",Divide:"/",And:"&",Or:"|",key:function(e){var t=void 0;return _.find(this,function(n,o){return n===e?(t=o,!0):!1}),t}},Function:{Lower:"lower",Upper:"upper",Abs:"abs",AsString:"str",key:function(e){var t=void 0;return _.find(this,function(n,o){return n===e?(t=o,!0):!1}),t}}}),e.QCompound=Backbone.Model.extend({defaults:{op:"and"},initialize:function(e){e=e||{};var t=e.queries;this.queries=t instanceof Backbone.Collection?t:new Backbone.Collection(t)},and:function(t){if(void 0===t||t.isNull())return this;if(this.isNull())return t;if(this.get("op")===e.Q.Op.And){var n=this.queries.slice(0);return n.push(t),new e.QCompound({op:e.Q.Op.And,queries:n})}return new e.QCompound({op:e.Q.Op.And,queries:new Backbone.Collection([this,t])})},clone:function(){var t={op:this.get("op"),queries:this.queries.clone()};return new e.QCompound(t)},isNull:function(){var e=!0;return this.queries.each(function(t){t.isNull()||(e=!1)}),e},or:function(t){if(void 0===t||t.isNull())return this;if(this.isNull())return t;if(this.get("op")===e.Q.Op.Or){var n=this.queries.slice(0);return n.push(t),new e.QCompound({op:e.Q.Op.Or,queries:n})}return new e.QCompound({op:e.Q.Op.Or,queries:[this,t]})},toJSON:function(){return{type:"compound",op:e.Q.Op.key(this.get("op")),queries:this.queries.toJSON()}}})}(window.orb)},{}],6:[function(e,t,n){!function(e,t){e.Index=Backbone.Model.extend({defaults:{name:"",dbname:"",unique:!1,order:void 0,cached:!1,timeout:0},initialize:function(){var t=Backbone.Collection.extend({model:e.Column});this.columns=new t},toJSON:function(){return{name:this.get("name"),dbname:this.get("dbname"),unique:this.get("unique"),order:this.get("order"),cached:this.get("cached"),timeout:this.get("timeout")}}}),e.Pipe=Backbone.Model.extend({defaults:{name:"",through:"",from:"",to:"",unique:!1},toJSON:function(){return{name:this.get("name"),through:this.get("through"),from:this.get("from"),to:this.get("to"),unique:this.get("unique")}}}),e.Column=Backbone.Model.extend({defaults:{type:"",name:"",field:"",display:"",reference:void 0,index:void 0,flags:0,"default":void 0,defaultOrder:"asc"},testFlag:function(e){return(self.get("flags")&e)>0},toJSON:function(){var e=this.get("index"),t=void 0;return e&&(t={name:e.get("name"),cached:e.get("cached"),timeout:e.get("timeout")}),{type:this.get("type"),name:this.get("name"),field:this.get("field"),display:this.get("display"),flags:this.get("flags"),defaultOrder:this.get("defaultOrder"),"default":this.get("default"),index:t}}}),e.Schema=Backbone.Model.extend({defaults:{name:"","abstract":!1,dbname:"",display:"",inherits:"",type:"",idColumn:"id"},initialize:function(){this.columns=new Backbone.Collection,this.columns.comparator=function(e){return e.get("name")},this.indexes=new Backbone.Collection,this.indexes.comparator=function(e){return e.get("name")},this.pipes=new Backbone.Collection,this.pipes.comparator=function(e){return e.get("name")}},toJSON:function(){return{name:this.get("name"),"abstract":this.get("abstract"),dbname:this.get("dbname"),display:this.get("display"),inherits:this.get("inherits"),columns:this.columns.toJSON(),indexes:this.indexes.toJSON(),pipes:this.pipes.toJSON()}}},{generateModel:function(t){t=t||{};var n=t.schema,o=t.scope||{},i={};n.referenceScope=o;var r={schema:n};_.each(n.columns,function(e,t){"Id"!==e.type&&(i[t]=e["default"])}),_.each(n.collectors,function(e){e.flags.Static&&(r[e.name]=function(t){var i;return i=e.model?new o[e.model].collection:new Backbone.Collection,i.url=n.urlRoot+"/"+e.name,i})}),_.each(n.indexes,function(t){r[t.name]=function(){var i=arguments;if(arguments.length-1!==_.size(t.columns))throw"Invalid number of arguments to "+n.model+"."+t.name;var r=new e.Q;_.each(t.columns,function(t,n){r=r.and(new e.Q(t).is(i[n]))});var s,c=o[n.model].select({where:r}),a=i[i.length-1];return s=t.flags.Unique?c.fetchOne(a):c.fetch(a)}});var s=e.Model.extend({idAttribute:n.idColumn,urlRoot:n.urlRoot,defaults:i},r);return s.collection=e.Collection.extend({model:s}),s}})}(window.orb,jQuery)},{}]},{},[1]);
